# 第一章 计算机和互联网

## 1、什么是互联网？

节点和边的关系，是一张图。

到了计算机网络中，节点包含主机节点、数据交换节点（路由器、交换机等）。数据交换节点不是信息源，也不是信息接收目标。我们使用方形来代表主机节点，为了方便，我记为x，用y表示数据交换节点。

主机节点和数据交换节点等之间的通路，称为**通信链路**。其通信速率用bps衡量，即bit per second。

主机连接到互联网的链路，称为接入网链路。路由器间的链路称为主干链。

协议的概念：共同遵守的标准。在不同层有不同的协议，包括语法、语义、时序、动作。

互联网指以TCP/IP协议为主形成的网络，并且与外界相连。不联通，则为intranet。

通讯的过程中，“对等层的实体”要遵守的规范，称为“协议”。

Internet标准在IETF处以RFC文档形式进行发布。

协议包括人类协议和网络协议。

互联网是分布式的应用进程以及为其通信提供服务的基础设施。

## 2、网络的边缘

网络包括网络的核心、网络的接入、网络的边缘。

网络边缘指的是主机及应用程序。

接入系统是用于把网络的边缘接入网络的核心。

核心系统起数据交换的作用。是一个枢纽。

网络边缘主要有两种模式：客户/服务器模式，以及对等（peer-peer）模式。

在CS模式中，服务器需要先启动，是主；客户端是从。所有的资源都在服务器上。但是，这种模式的可扩展性较差。当访问请求达到一定阈值时，效能断崖式下降。

在p2p模式中，每个节点，在某些会话中，可以作为客户端；在某些过程中，又可以作为服务端。

网络边缘：采用面向连接的通信服务，指的是通信状态只在端系统上可以获知。

可靠性：不重复，不丢失，不出错，不失序。

TCP会保证可靠性，也会进行流量控制，保证包发送速度在端节点合适；也会进行拥塞控制，保证包发送速度在链路上的中转节点合适。

UDP则无连接，不可靠，没有流量控制和拥塞控制。适用于直播等。

## 3、网络核心

一般具有两种方式：电路交换和分组交换。

两个主机使用信令系统申请（会耗费一定的时间）后，可以独享一条链路（线路中的一部分）以供通信。不共享可以保证性能，但是可能会导致资源浪费。就算没有流量，这一条通道持续在被占用。

有一个问题，用什么方式来把带宽资源分成片？有频分、时分、波分（光通信）。频分，指的是把不同的频率分开；时分，指的是划分为一定量的时间片，由于周期不变，对应的数据会给到对应的用户；波分，和频分的操作方式较为类似。

但是电路交换不适合于计算机的通信。因为建立通信需要一定的时间，而且计算机之间的通信具有很强的突发性，会导致较多网络资源的浪费。

而且，若一个核心节点被损毁，影响会很大。

另外一种通信的方式，是分组交换的方式。首先，会将文件分为多个包。在这种方式中，每一个链路上都会暂时占有链路的全部。然后，资料会被存储在交换节点中。之后，再进行下一步转发。这样可以减少对网络资源的浪费。用排队和存储的时间，换取了网络的共享性。

如果到达速率快过了输出的速率，分组将会排队，等待传输。如果**队伍过长**，缓存被填满了，那么分组将会被抛弃。文件可能会被传丢了。

但是，分组交换可以容纳更多的主机进行传输。

路由：决定分组采用的从源到目标的路径。

转发：将分组从路由器的输入链路转发到输出链路。

因此，分组交换适用于强突发性的情况。

数据报、虚电路两种不同的存储转发策略。数据报方式不用在节点上维护通信状态，目标节点都 已存在数据中了；虚电路则需要维护节点处的通信状态，在交流数据之前需要靠信令建立起来，根据虚电路表进行操作。

## 4、接入网和物理媒体

 住宅接入：modem，调制解调器（猫）。

一种方式是利用已有的电话线，用于传输数据。因为电话传输的语音，传输的频率只有4kHz。因此，使用调制解调器，把数据调制为4kHz内。从而进行数据的传输。

一种方式是进行接入网（DSL）。4kHz内用于电话通信。更高的频率，用于上下行的传输数据。

还有一种方式是使用有线电视公司的线，即 线缆网络。

国外还可以使用电网来传输数据。

剩下的还有无线接入网络。

还有企业接入网络。

物理媒介有导引性媒体，以及非导引性媒体。导引性，指的就是有限制的传输媒体。比如同轴电缆、光纤等。非导引性的就是无线的，比如地面微波，LAN，wide-area，卫星等。

## 5、Internet结构和ISP

端系统通过接入ISP来连接到互联网。即Internet Service Providers。

接入ISP之间，应当是互联的。

显然它们不应当直接相连，没有可扩展性。

所以，可以把接入ISP连接到全局的ISP，从而完成数据之间的收发。

全局ISP可以由不同运营商承担。同时，运营商之间也应当连接链路。

可以有对等连接方式，还有IXP(internet exchange point)，作为共同的中转站。

regional ISP就是负责区域网的ISP。

对于Google，Wechat等会在各地部署数据中心，在海底可以拉一根光缆从而传输数据，从而降低成本，并且提高用户的体验。

因此，互联网的中心是第一层的ISP。

第二层的ISP则是区域性的了。

## 6、分组延时、丢失和吞吐量

四种分组延时的方式：

节点处理延时：检查是否出错，并且检查路由表。

排队延时：排队。

传输延时：传输所需的时间和存储转发延时。

传播延时：通过物理介质传播所需的时间。

排队延时取决于流量强度。$I={La\over R}$

L为每个包的数据量，a为每单位时间来到的包总数，R则为单位时间内可以发出的数据量。流量强度应当在0,1之间。

ICMP协议：互联网控制报文协议。

对于信息中，存在IP头，其中存有生存时间（ttl），当时间超过之后，则会向源地址发送一个信息，并且回报自己的ip，并回报“目标地址不可达”。生存时间，没被转发一次，就会减1。

吞吐量：源端和目标端之间数据的传输速率。我们把影响吞吐量的那一条链路，称为“瓶颈链路”。



## 7、协议层次与服务模型

计算机网络通过分层模块的方式。

协议是在本层内的，为了向上层提供更高的服务。每一层可以调用下一层的服务，使用接口进行调用。同层之间的交流，可以为上层提供出新的服务。该层对上层的服务包括**以下层的服务之总和**，以及同层间通过交互所形成的新的功能。

不过物理层就没有下一层辣。

服务访问点（SAP）：用于下层的服务提供者来区分上层的用户，即用于标识。

原语：用于层间的交流，说明调用的功能等。

服务的类型分为面向连接的服务，以及无连接的服务。面向连接，即指使用下层提供的服务之前，必须要在上层之间建立连接，如TCP。反之，则是无连接的服务，如UDP。

数据单元(DU)：

上层要求传输到下层的主要内容是SDU(Serivice data unit)。为了便于控制，还会添加一部分header。这两部分共同组成了PDU。如此从上层至下层，层层相叠，便构成了该层总的PDU。

Internet的协议栈为：应用层、传输层、网络层、链路层、物理层。

物理层：把数字数据转化为物理信号使之传输。

链路层：在相邻两点间传输以帧为单位的数据。

网络层：解决从源到目标节点的传输。转发和路由两种重要的功能就在这里。

传输层：解决进程之间的区分问题。同时会将下层的不可靠服务转化为可靠的服务。

ISO/OSI将前面修改为了：应用层、表示层、会话层、传输层、...

表示层用于解释传输的数据，比如加密、压缩等。会话层则是为了进行数据交换的同步，检查点，以及恢复。在Internet协议栈中，这两部分都被归在了应用层中。

# 第二章 应用层

## 1、应用层原理

C/S模式、P2P模式，混合体模式。

进程之间的通信：在同一主机上，使用自身的OS即可。如果在不同主机间，则是通过交换报文的方式来进行通信。客户端进程，指的是发出请求的进程。服务器进程，指的是等待连接的进程。 

分布式进程通信需要解决的问题：标识自身和对象，下一层如何提供服务，如何使用下一层的服务。 

端口号用于区分不同的进程。 层间接口必须要将数据本身、传输数据的源地址，对方的应用进程标识进行传输。

如何简化这一个过程？就是使用socket方法。当建立了通信关系以后，直接用一个整数代表一个通信的过程，（TCP）即源IP、port和目标IP和port。 同时，会记录这个通信的状态。如果是UDP，显然就应该只有两个内容，即本机IP和port。但是在传输的时候，UDP也需要指明接受的对象。

应用层协议：定义了应用进程之间如何相互传输报文。常见的，比如说有HTTP协议等。协议也分为公开协议和专有协议。

我们需要传输层需要向上层提高这些方面的性能：数据丢失率、延迟、吞吐、安全性。

TCP：可靠、流量控制、拥塞控制、 面向连接。

UDP是不可靠的。但是，他比IP好的地方在于，他可以直接将数据传到对应的进程。同时，牺牲了可靠性，可以加速很多。

TCP是没有进行加密的。进行加密的是SSL。应用层在使用SSL的基础上使用TCP，那么就可以进行安全的传输服务。SSL在应用层中。
